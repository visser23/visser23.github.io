<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0f">
  <!-- Reduce browser fingerprinting on media requests -->
  <meta name="referrer" content="no-referrer">
  <meta name="description" content="Simple IPTV - A lightweight, privacy-respecting IPTV web player">
  <title>Simple IPTV</title>
  
  <!-- CRITICAL CSS - Inlined for faster First Contentful Paint -->
  <style>
    :root{--color-bg-primary:#0a0a0f;--color-bg-secondary:#12121a;--color-bg-tertiary:#1a1a25;--color-glass:rgba(20,20,30,.8);--color-glass-border:rgba(255,255,255,.08);--color-text-primary:#f0f0f5;--color-text-muted:#606070;--color-accent:#00d4ff;--color-accent-glow:rgba(0,212,255,.3);--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;--header-height:60px;--sidebar-width:280px;--transition-fast:150ms ease}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html{font-size:16px;-webkit-font-smoothing:antialiased}
    body{font-family:var(--font-family);color:var(--color-text-primary);background:var(--color-bg-primary);overflow:hidden}
    .app{display:flex;flex-direction:column;height:100vh;height:100dvh;overflow:hidden}
    .header{display:flex;align-items:center;gap:1rem;height:var(--header-height);padding:0 1rem;background:var(--color-glass);backdrop-filter:blur(12px);border-bottom:1px solid var(--color-glass-border)}
    .main{display:flex;flex:1;overflow:hidden}
    .sidebar{display:flex;flex-direction:column;width:var(--sidebar-width);background:var(--color-bg-secondary);border-right:1px solid var(--color-glass-border)}
    .player-area{flex:1;display:flex;flex-direction:column;background:var(--color-bg-primary);overflow:hidden}
    .spinner{width:48px;height:48px;border:3px solid var(--color-bg-tertiary);border-top-color:var(--color-accent);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .player-loading{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;background:rgba(0,0,0,.7);z-index:10}
    [hidden]{display:none!important}
    @media(max-width:768px){:root{--sidebar-width:100%;--header-height:56px}.sidebar{position:fixed;top:var(--header-height);left:0;right:0;bottom:0;transform:translateX(-100%);z-index:100}}
  </style>
  
  <!-- Full stylesheet - loaded after critical CSS is painted -->
  <link rel="stylesheet" href="src/css/main.css?v=29">
  
  <!-- Preconnect to CDN for faster lib loading -->
  <link rel="preconnect" href="https://esm.sh">
</head>
<body>
  <!-- App Container -->
  <div id="app" class="app">
    
    <!-- Header -->
    <header class="header">
      <div class="header__brand">
        <span class="header__logo">â—ˆ</span>
        <span class="header__title">Simple<span class="accent">IPTV</span></span>
      </div>
      
      <div class="header__search">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
        <input type="text" id="search-input" class="search-input" placeholder="Search all content... (press /)" autocomplete="off">
        <kbd class="search-hint">/</kbd>
      </div>
      
      <div class="header__actions">
        <a href="https://www.paypal.com/paypalme/viss23/5GBP" target="_blank" rel="noopener" class="header-btn header-btn--coffee" title="Buy me a coffee">
          <span>â˜•</span>
          <span>Buy me a coffee</span>
        </a>
        <button id="btn-settings" class="header-btn header-btn--settings" title="Settings">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/>
          </svg>
          <span>Settings</span>
        </button>
        <button id="btn-logout" class="header-btn header-btn--logout" title="Logout" hidden>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          <span>Logout</span>
        </button>
      </div>
    </header>
    
    <!-- Main Content - EPG Style Layout -->
    <main class="main main--epg">
      
      <!-- Left Sidebar: Navigation -->
      <aside class="sidebar" id="sidebar">
        <!-- Content Type Tabs -->
        <div class="content-tabs" id="content-tabs">
          <button class="content-tab content-tab--active" data-type="live" title="Live TV">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
              <polyline points="17 2 12 7 7 2"/>
            </svg>
            <span>Live</span>
          </button>
          <button class="content-tab" data-type="movies" title="Movies">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
              <line x1="7" y1="2" x2="7" y2="22"/>
              <line x1="17" y1="2" x2="17" y2="22"/>
              <line x1="2" y1="12" x2="22" y2="12"/>
            </svg>
            <span>Movies</span>
          </button>
          <button class="content-tab" data-type="series" title="Series">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 11a9 9 0 0 1 9 9"/>
              <path d="M4 4a16 16 0 0 1 16 16"/>
              <circle cx="5" cy="19" r="2"/>
            </svg>
            <span>Series</span>
          </button>
        </div>
        
        <!-- Quick Access: Favourites & Recents -->
        <div class="sidebar__quick">
          <button class="category-item" data-category="__favorites__">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            <span>Favourites</span>
            <span class="category-count" id="count-favorites">0</span>
          </button>
          <button class="category-item" data-category="__recents__">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
            </svg>
            <span>Recents</span>
            <span class="category-count" id="count-recents">0</span>
          </button>
        </div>
        
        <!-- Folders/Categories List -->
        <nav class="categories" id="categories">
          <div class="categories__header">
            <span>Folders</span>
            <span class="category-count" id="count-all">0</span>
          </div>
          <div class="categories__section categories__groups" id="category-groups">
            <!-- Dynamically populated folder buttons -->
          </div>
        </nav>
      </aside>
      
      <!-- Main Content Area -->
      <section class="content-area" id="content-area">
        
        <!-- Onboarding (shown when no playlist) -->
        <div class="onboarding" id="onboarding">
          <div class="onboarding__content">
            <div class="onboarding__icon">â—ˆ</div>
            <h1 class="onboarding__title">Welcome to Simple<span class="accent">IPTV</span></h1>
            <p class="onboarding__subtitle">A lightweight, privacy-respecting IPTV player.<br>All data stays on your device.</p>
            
            <button class="btn btn--primary btn--large" id="btn-add-playlist">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Add Playlist
            </button>
            
            <div class="onboarding__warnings">
              <div class="warning-item">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span>Cannot bypass DRM-protected streams</span>
              </div>
              <div class="warning-item">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span>CORS restrictions may block some providers</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- EPG View (hidden until playlist loaded) -->
        <div class="epg-view" id="epg-view" hidden>
          
          <!-- Top Row: Now Playing Info + Video Player -->
          <div class="epg-view__top">
            
            <!-- Now Playing Info Panel -->
            <div class="now-playing-panel" id="now-playing-panel">
              <div class="now-playing-panel__logo" id="channel-logo-container">
                <img id="channel-logo" src="" alt="" hidden>
                <div class="now-playing-panel__logo-placeholder" id="channel-logo-placeholder">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
                    <polyline points="17 2 12 7 7 2"/>
                  </svg>
                </div>
              </div>
              <div class="now-playing-panel__info">
                <h2 class="now-playing-panel__title" id="panel-channel-name">Select a channel</h2>
                <div class="now-playing-panel__meta" id="panel-meta">
                  <span class="now-playing-panel__category" id="panel-category"></span>
                </div>
                <!-- EPG Info for Live -->
                <div class="now-playing-panel__epg" id="panel-epg" hidden>
                  <div class="panel-epg__now">
                    <span class="panel-epg__label">Now</span>
                    <span class="panel-epg__title" id="panel-epg-now">â€”</span>
                  </div>
                  <div class="panel-epg__progress">
                    <div class="panel-epg__progress-fill" id="panel-epg-progress"></div>
                  </div>
                  <div class="panel-epg__next">
                    <span class="panel-epg__label">Next</span>
                    <span class="panel-epg__title" id="panel-epg-next">â€”</span>
                    <span class="panel-epg__time" id="panel-epg-next-time"></span>
                  </div>
                </div>
                <!-- VOD Metadata -->
                <div class="now-playing-panel__vod" id="panel-vod" hidden>
                  <span class="panel-vod__duration" id="panel-vod-duration"></span>
                  <span class="panel-vod__year" id="panel-vod-year"></span>
                  <span class="panel-vod__rating" id="panel-vod-rating"></span>
                </div>
              </div>
            </div>
            
            <!-- Video Player -->
            <div class="player" id="player">
              <div class="player__container">
                <video id="video" class="player__video" playsinline></video>
                
                <!-- Player Overlay -->
                <div class="player__overlay" id="player-overlay">
                  <div class="player__loading" id="player-loading" hidden>
                    <div class="spinner"></div>
                    <span>Loading stream...</span>
                  </div>
                  
                  <div class="player__error" id="player-error" hidden>
                    <svg class="icon icon--large" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                    <div id="error-message">
                      <span class="error-title">Stream unavailable</span>
                    </div>
                    <button class="btn btn--outline btn--small" id="btn-copy-url">
                      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                      </svg>
                      Copy Stream URL
                    </button>
                  </div>
                </div>
                
                <!-- Player Controls -->
                <div class="player__controls" id="player-controls">
                  <div class="controls__progress">
                    <div class="progress-bar" id="progress-bar">
                      <div class="progress-bar__fill" id="progress-fill"></div>
                      <div class="progress-bar__scrubber" id="progress-scrubber"></div>
                    </div>
                    <div class="progress-bar__tooltip" id="progress-tooltip">0:00</div>
                  </div>
                  <div class="controls__buttons">
                    <button class="btn-icon" id="btn-play-pause" title="Play/Pause">
                      <svg class="icon icon-play" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                      </svg>
                      <svg class="icon icon-pause is-hidden" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>
                      </svg>
                    </button>
                    
                    <div class="volume-control">
                      <button class="btn-icon" id="btn-mute" title="Mute">
                        <svg class="icon icon-volume" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                          <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                          <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                        </svg>
                        <svg class="icon icon-muted is-hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                          <line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/>
                        </svg>
                      </button>
                      <input type="range" class="volume-slider" id="volume-slider" min="0" max="1" step="0.05" value="1">
                    </div>
                    
                    <div class="controls__spacer"></div>
                    
                    <span class="now-playing" id="now-playing">No channel selected</span>
                    
                    <div class="controls__spacer"></div>
                    
                    <button class="btn-icon" id="btn-pip" title="Picture-in-Picture">
                      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2"/>
                        <rect x="11" y="9" width="9" height="6" rx="1"/>
                      </svg>
                    </button>
                    
                    <button class="btn-icon" id="btn-fullscreen" title="Fullscreen">
                      <svg class="icon icon-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/>
                        <line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>
                      </svg>
                      <svg class="icon icon-compress is-hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/>
                        <line x1="14" y1="10" x2="21" y2="3"/><line x1="3" y1="21" x2="10" y2="14"/>
                      </svg>
                    </button>
                    
                    <button class="btn-icon" id="btn-copy-stream" title="Copy Stream URL">
                      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Bottom: Channel/Content List -->
          <div class="epg-view__content">
            <!-- Live TV: Channel Rows with Now/Next -->
            <div class="channel-list channel-list--epg" id="channel-list" data-view="live">
              <div class="channel-list__viewport" id="channel-viewport">
                <div class="channel-list__content" id="channel-content">
                  <!-- Channels rendered here as rows -->
                </div>
              </div>
            </div>
            
            <!-- Movies/Series: Grid Panels -->
            <div class="content-grid" id="content-grid" data-view="vod" hidden>
              <div class="content-grid__inner" id="content-grid-inner">
                <!-- Grid of movie/series cards rendered here -->
              </div>
            </div>
          </div>
          
        </div>
      </section>
    </main>
  </div>
  
  <!-- Modals -->
  
  <!-- Add Playlist Modal -->
  <dialog class="modal" id="modal-playlist">
    <div class="modal__header">
      <h2 class="modal__title">Add Playlist</h2>
      <button class="btn-icon modal__close" id="modal-playlist-close">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="modal__body">
      <!-- Tabs -->
      <div class="tabs" id="playlist-tabs">
        <button class="tab tab--active" data-tab="xtream">Xtream Codes</button>
        <button class="tab" data-tab="m3u-url">M3U URL</button>
        <button class="tab" data-tab="m3u-file">Upload File</button>
      </div>
      
      <!-- Xtream Form -->
      <form class="form tab-content tab-content--active" id="form-xtream" data-tab="xtream">
        <div class="form-group">
          <label for="xtream-server">Server URL</label>
          <input type="url" id="xtream-server" class="input" placeholder="http://provider.example.com:8080" required>
          <span class="form-hint">Include port if required (e.g., :8080)</span>
        </div>
        <div class="form-group">
          <label for="xtream-username">Username</label>
          <input type="text" id="xtream-username" class="input" placeholder="Your username" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="xtream-password">Password</label>
          <input type="password" id="xtream-password" class="input" placeholder="Your password" required autocomplete="current-password">
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="xtream-remember" checked>
            <span>Remember on this device</span>
          </label>
          <span class="form-hint">Stored locally with obfuscation (not encryption)</span>
        </div>
      </form>
      
      <!-- M3U URL Form -->
      <form class="form tab-content" id="form-m3u-url" data-tab="m3u-url" hidden>
        <div class="form-group">
          <label for="m3u-url">Playlist URL</label>
          <input type="url" id="m3u-url" class="input" placeholder="https://example.com/playlist.m3u" required>
        </div>
        <div class="form-group">
          <label for="epg-url">EPG URL (optional)</label>
          <input type="url" id="epg-url" class="input" placeholder="https://example.com/epg.xml">
          <span class="form-hint">XMLTV format for program guide</span>
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="m3u-url-remember" checked>
            <span>Remember on this device</span>
          </label>
        </div>
      </form>
      
      <!-- M3U File Form -->
      <form class="form tab-content" id="form-m3u-file" data-tab="m3u-file" hidden>
        <div class="form-group">
          <label for="m3u-file">Select M3U File</label>
          <div class="file-drop" id="file-drop">
            <svg class="icon icon--large" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <span>Drop file here or click to browse</span>
            <input type="file" id="m3u-file" accept=".m3u,.m3u8,text/plain" hidden>
          </div>
          <span class="form-hint" id="file-name"></span>
        </div>
        <div class="form-group">
          <label for="file-epg-url">EPG URL (optional)</label>
          <input type="url" id="file-epg-url" class="input" placeholder="https://example.com/epg.xml">
        </div>
      </form>
      
      <!-- Loading State -->
      <div class="form-loading" id="form-loading" hidden>
        <div class="spinner"></div>
        <span id="loading-message">Loading playlist...</span>
        <div class="progress-bar" id="loading-progress-container" hidden>
          <div class="progress-bar__fill" id="loading-progress"></div>
        </div>
      </div>
      
      <!-- Error State -->
      <div class="form-error" id="form-error" hidden>
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span id="error-text">An error occurred</span>
      </div>
    </div>
    
    <div class="modal__footer">
      <button type="button" class="btn btn--outline" id="btn-cancel-playlist">Cancel</button>
      <button type="submit" class="btn btn--primary" id="btn-load-playlist">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
        Load Playlist
      </button>
    </div>
  </dialog>
  
  <!-- Settings Modal -->
  <dialog class="modal" id="modal-settings">
    <div class="modal__header">
      <h2 class="modal__title">Settings</h2>
      <button class="btn-icon modal__close" id="modal-settings-close">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="modal__body">
      <div class="settings-section">
        <h3 class="settings-title">Playlist</h3>
        <div class="settings-item">
          <div class="settings-info">
            <span class="settings-label">Current playlist</span>
            <span class="settings-value" id="settings-playlist-info">None loaded</span>
          </div>
          <button class="btn btn--outline btn--small" id="btn-change-playlist">Change</button>
        </div>
        <div class="settings-item">
          <div class="settings-info">
            <span class="settings-label">Refresh playlist</span>
            <span class="settings-value">Re-fetch channels from source</span>
          </div>
          <button class="btn btn--outline btn--small" id="btn-refresh-playlist">Refresh</button>
        </div>
      </div>
      
      <div class="settings-section">
        <h3 class="settings-title">Security</h3>
        <div class="settings-item">
          <div class="settings-info">
            <span class="settings-label">Vault Mode (PIN)</span>
            <span class="settings-value">Encrypt credentials with a PIN</span>
          </div>
          <label class="toggle">
            <input type="checkbox" id="toggle-vault">
            <span class="toggle__slider"></span>
          </label>
        </div>
        <p class="settings-note">
          âš ï¸ Note: A short PIN provides limited protection. This is convenience, not security.
        </p>
      </div>
      
      <div class="settings-section">
        <h3 class="settings-title">Playback</h3>
        <div class="settings-item">
          <div class="settings-info">
            <span class="settings-label">Stream Proxy URL</span>
            <span class="settings-value">Route streams through a CORS proxy</span>
          </div>
        </div>
        <div class="form-group" style="margin-top: 0.5rem;">
          <input type="url" class="input" id="proxy-url" placeholder="https://your-proxy.workers.dev/">
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <button class="btn btn--outline btn--small" id="btn-save-proxy">Save</button>
            <button class="btn btn--outline btn--small" id="btn-test-proxy">Test Proxy</button>
          </div>
        </div>
        <p class="settings-note">
          ğŸ’¡ If streams are blocked, deploy your own <a href="#" id="link-proxy-help" style="color: var(--color-accent);">Cloudflare Worker proxy</a> (free) and enter the URL above.
        </p>
        <div id="proxy-test-results" class="proxy-test-results" hidden>
          <div class="proxy-test-header">
            <span class="proxy-test-status" id="proxy-test-status">Testing...</span>
          </div>
          <pre class="proxy-test-log" id="proxy-test-log"></pre>
        </div>
      </div>
      
      <div class="settings-section">
        <h3 class="settings-title">Search</h3>
        <div class="settings-item">
          <div class="settings-info">
            <span class="settings-label">Content Language</span>
            <span class="settings-value" id="settings-locale-info">Auto-detected</span>
          </div>
          <select class="input select--small" id="locale-select" style="width: auto; min-width: 160px;">
            <option value="">Auto-detect</option>
            <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
            <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
            <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
            <option value="FR">ğŸ‡«ğŸ‡· France</option>
            <option value="ES">ğŸ‡ªğŸ‡¸ Spain</option>
            <option value="IT">ğŸ‡®ğŸ‡¹ Italy</option>
            <option value="PT">ğŸ‡µğŸ‡¹ Portugal</option>
            <option value="BR">ğŸ‡§ğŸ‡· Brazil</option>
            <option value="NL">ğŸ‡³ğŸ‡± Netherlands</option>
            <option value="PL">ğŸ‡µğŸ‡± Poland</option>
            <option value="RU">ğŸ‡·ğŸ‡º Russia</option>
            <option value="TR">ğŸ‡¹ğŸ‡· Turkey</option>
            <option value="SA">ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
            <option value="AE">ğŸ‡¦ğŸ‡ª UAE</option>
            <option value="IN">ğŸ‡®ğŸ‡³ India</option>
            <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
            <option value="KR">ğŸ‡°ğŸ‡· South Korea</option>
            <option value="CN">ğŸ‡¨ğŸ‡³ China</option>
            <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
            <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
            <option value="MX">ğŸ‡²ğŸ‡½ Mexico</option>
            <option value="SE">ğŸ‡¸ğŸ‡ª Sweden</option>
            <option value="NO">ğŸ‡³ğŸ‡´ Norway</option>
            <option value="DK">ğŸ‡©ğŸ‡° Denmark</option>
            <option value="FI">ğŸ‡«ğŸ‡® Finland</option>
            <option value="GR">ğŸ‡¬ğŸ‡· Greece</option>
            <option value="RO">ğŸ‡·ğŸ‡´ Romania</option>
            <option value="HU">ğŸ‡­ğŸ‡º Hungary</option>
            <option value="CZ">ğŸ‡¨ğŸ‡¿ Czech Republic</option>
            <option value="UA">ğŸ‡ºğŸ‡¦ Ukraine</option>
          </select>
        </div>
        <p class="settings-note">
          ğŸ’¡ Search results will prioritize content in your preferred language. Auto-detect uses your browser locale or IP location.
        </p>
      </div>
      
      <div class="settings-section">
        <h3 class="settings-title">Data</h3>
        <div class="settings-item">
          <div class="settings-info">
            <span class="settings-label">Export settings</span>
            <span class="settings-value">Download as JSON file</span>
          </div>
          <button class="btn btn--outline btn--small" id="btn-export">Export</button>
        </div>
        <div class="settings-item">
          <div class="settings-info">
            <span class="settings-label">Import settings</span>
            <span class="settings-value">Load from JSON file</span>
          </div>
          <button class="btn btn--outline btn--small" id="btn-import">Import</button>
          <input type="file" id="import-file" accept=".json,application/json" hidden>
        </div>
      </div>
      
      <div class="settings-section">
        <h3 class="settings-title">About</h3>
        <p class="settings-about">
          <strong>Simple IPTV</strong> v1.0.0<br>
          A lightweight, privacy-respecting IPTV player.<br>
          No accounts. No tracking. All data stays local.
        </p>
        <p class="settings-note">
          This app cannot bypass DRM or CORS restrictions. Some streams may not work in a browser.
        </p>
      </div>
    </div>
    
    <div class="modal__footer">
      <button type="button" class="btn btn--primary" id="btn-close-settings">Done</button>
    </div>
  </dialog>
  
  <!-- PIN Entry Modal -->
  <dialog class="modal modal--small" id="modal-pin">
    <div class="modal__header">
      <h2 class="modal__title" id="pin-title">Enter PIN</h2>
    </div>
    <div class="modal__body">
      <p class="pin-description" id="pin-description">Enter your PIN to unlock credentials.</p>
      <div class="pin-input-group">
        <input type="password" class="pin-input" id="pin-input" maxlength="8" pattern="[0-9]*" inputmode="numeric" autocomplete="one-time-code">
      </div>
      <p class="form-error" id="pin-error" hidden>Incorrect PIN</p>
    </div>
    <div class="modal__footer">
      <button type="button" class="btn btn--outline" id="btn-cancel-pin">Cancel</button>
      <button type="button" class="btn btn--primary" id="btn-submit-pin">Unlock</button>
    </div>
  </dialog>
  
  <!-- Confirm Dialog -->
  <dialog class="modal modal--small" id="modal-confirm">
    <div class="modal__header">
      <h2 class="modal__title" id="confirm-title">Confirm</h2>
    </div>
    <div class="modal__body">
      <p id="confirm-message">Are you sure?</p>
    </div>
    <div class="modal__footer">
      <button type="button" class="btn btn--outline" id="btn-confirm-cancel">Cancel</button>
      <button type="button" class="btn btn--danger" id="btn-confirm-ok">Confirm</button>
    </div>
  </dialog>
  
  <!-- Toast Notifications -->
  <div class="toast-container" id="toast-container"></div>
  
  <!-- Search Overlay (Netflix-style full-screen search) -->
  <div class="search-overlay" id="search-overlay" hidden>
    <div class="search-overlay__header">
      <div class="search-overlay__bar">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
        <input type="text" id="search-overlay-input" class="search-overlay__input" placeholder="Search movies, series, channels..." autocomplete="off" autofocus>
        <button class="search-overlay__clear" id="search-overlay-clear" title="Clear search">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <button class="search-overlay__close" id="search-overlay-close" title="Close search">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
        <span>Close</span>
      </button>
    </div>
    
    <!-- Filter Tabs -->
    <div class="search-overlay__filters" id="search-filters">
      <button class="search-filter search-filter--active" data-filter="all">All</button>
      <button class="search-filter" data-filter="live">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
          <polyline points="17 2 12 7 7 2"/>
        </svg>
        Live
      </button>
      <button class="search-filter" data-filter="vod">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
          <line x1="7" y1="2" x2="7" y2="22"/>
          <line x1="17" y1="2" x2="17" y2="22"/>
          <line x1="2" y1="12" x2="22" y2="12"/>
        </svg>
        Movies
      </button>
      <button class="search-filter" data-filter="series">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 11a9 9 0 0 1 9 9"/>
          <path d="M4 4a16 16 0 0 1 16 16"/>
          <circle cx="5" cy="19" r="2"/>
        </svg>
        Series
      </button>
    </div>
    
    <!-- Results Info -->
    <div class="search-overlay__info" id="search-info">
      <span id="search-result-count">Type to search...</span>
      <span id="search-loading-indicator" class="search-loading-indicator" hidden>
        <span class="spinner-small"></span>
        Loading movies & series...
      </span>
    </div>
    
    <!-- Results Grid -->
    <div class="search-overlay__results" id="search-results">
      <div class="search-grid" id="search-grid">
        <!-- Cards rendered here -->
      </div>
      
      <!-- Loading State -->
      <div class="search-loading" id="search-loading" hidden>
        <div class="spinner"></div>
        <span>Loading content...</span>
      </div>
      
      <!-- Empty State -->
      <div class="search-empty" id="search-empty" hidden>
        <svg class="icon icon--large" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
        <span>No results found</span>
        <span class="search-empty__hint">Try a different search term</span>
      </div>
      
      <!-- Initial State -->
      <div class="search-initial" id="search-initial">
        <svg class="icon icon--large" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
        <span>Search across all content</span>
        <span class="search-initial__hint">Live channels, movies, and series</span>
      </div>
    </div>
  </div>
  
  <!-- DOM Templates (PERF: cloning is faster than innerHTML parsing) -->
  
  <!-- Channel Row Template (used in virtual scroll) -->
  <template id="channel-row-template">
    <div class="channel-row">
      <img class="channel-row__logo" alt="" loading="lazy">
      <div class="channel-row__logo-placeholder"></div>
      <div class="channel-row__name"></div>
      <div class="channel-row__now">
        <span class="channel-row__epg-label">Now</span>
        <span class="channel-row__epg-title"></span>
      </div>
      <div class="channel-row__next">
        <span class="channel-row__epg-label">Next</span>
        <span class="channel-row__epg-title"></span>
      </div>
      <div class="channel-row__no-epg">Now and next not available</div>
      <div class="channel-row__actions">
        <button class="channel-favorite" title="Add to favorites">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
          </svg>
        </button>
      </div>
    </div>
  </template>
  
  <!-- Search Card Template (used in content grid and search overlay) -->
  <template id="search-card-template">
    <div class="search-card" tabindex="0" role="button">
      <div class="search-card__image-container">
        <img class="search-card__image search-card__skeleton" alt="" loading="lazy">
        <div class="search-card__placeholder"></div>
        <div class="search-card__badge"></div>
        <div class="search-card__play">
          <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="5 3 19 12 5 21 5 3"/>
          </svg>
        </div>
      </div>
      <div class="search-card__content">
        <div class="search-card__title"></div>
        <div class="search-card__meta"></div>
      </div>
    </div>
  </template>
  
  <!-- Scripts (ES modules) -->
  <script type="module" src="src/js/app.js?v=27"></script>
</body>
</html>
